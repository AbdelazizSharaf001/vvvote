<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>VVVote</title>
<style type="text/css">
@import url(standard.css);
/* evtl. seitenspezifische CSS-Definitionen */
</style>

<!-- <script src="tests.js"></script> -->
<script src="config/config.js"></script>
<script src="exception.js"></script>
<script src="tools/mixed.js"></script>
<script src="tools/url.js"></script>
<script src="getelectionconfig.js"></script>
<!-- the following "<script>" is used as heredoc replacement -->
<script  id="authUserPasswHtml" type="mumpiz">
<div id="auth">
	<form name="permission" method="post" onsubmit="return false;">
		<div align="center">
			<br>
			<table>
				<tr>
					<td>
						<table>
							<tr>
								<td>&nbsp;</td>
								<td align=right><font color=black> <b>ElectionId:</b>
								</font></td>
								<td><input name=electionId value=""></td>
								<td>&nbsp;</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
								<td align=right><font color=black> <b>VoterId:</b>
								</font></td>
								<td><div id="divvoterid">
										<input name="voterId" id="voterId" value="">
									</div></td>
								<td>&nbsp;</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
								<td align=right><b>Secret:</b></td>
								<td><input name="secret" id="secret" value="" type="password"></td>
								<td>&nbsp;</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
								<td>&nbsp;</td>
								<td><input type="submit" name=reqPermiss
									value="Request ballot" onclick="onGetPermClick();"></td>
								<td>&nbsp;</td>
						</table>
					</td>
				</tr>
			</table>
		</div>
	</form>
<p><h2>Weitere technische Information</h2><br>
Der Wahlzettel ist digital von mindestens 2 Servern unterschrieben. Diese Unterschrift führt dazu, dass der Wahlzettel bei der Stimmabgabe akzeptiert wird.<br>
Der Wahlzettel enthält eine eindeutige Wahlzettelnummer, die nur Ihr Computer kennt - sie wurde von Ihrem Computer erzeugt und verschlüsselt, bevor die Server den Wahlzettel unterschrieben haben, und danach auf Ihrem Computer entschlüsselt (Man spricht von &quot;Blinded Signature&quot;). Die Server kennen daher die Wahlzettelnummer nicht.<br>
Man kann sich das so vorstellen:<br> 
Ihr Computer schreibt auf den Wahlzettel die Wahlzettelnummer, die er sich selbst &quot;ausdenkt&quot; (Zufallszahl). Dieser Wahlzettel wird zusammen mit einem Blatt Kohlepapier in einen Umschlag gelegt und an den Server geschickt. 
Der Server unterschreibt außen auf dem Umschlag (wenn Sie wahlberechtigt sind), so dass sich die Unterschrift durch das Kohlepapier auf Ihren Wahlzettel überträgt. Ohne den Umschlag geöffnet zu haben (was der Server nicht kann, weil er den dafür notwendigen Schlüssel nicht kennt), schickt er den Brief an Ihren Computer zurück.
Ihr Computer öffnet den Umschlag (d.h. entschlüsselt die Wahlzettelnummer) und hält einen vom Server unterschriebenen Wahlzettel in der Hand, deren Nummer der Server nicht kennt.  
</p>
</div>
</script>


<!-- the following "<script>" is used as heredoc replacement -->
<script  id="newElectionHtml" type="mumpiz">
	
	Hier können Sie eine neue Abstimmung starten.     
    Zum Anlegen einer neuen Abstimmung legen Sie den Namen der Abstimmung und das Abstimmungspasswort fest. Die W&auml;hler geben ihren Namen ein und k&ouml;nnen nur dann abstimmen, wenn sie das hier festgelegte Abstimmungspasswort kennen. Es kann also jeder abstimmen, der das Abstimmungspasswort kennt.
	<br> 
	<input type="text" id="electionId"> 
    	<label for="electionId">Name der Wahl</label> 
 	<br>
	<input type="text" id="givenPassword">
    	<label for="givenPassword">Abstimmungspasswort</label>
	<br>
	<input type="button" onclick="page.handleNewElectionButton();" value="Neue Abstimmung anlegen">		

</script>

<script src="modules-auth/user-passw-list/module.js"></script>
<script src="modules-auth/shared-passw/module.js"></script>
<script src="tools/BigInt.js"></script>
<script src="tools/rsa.js"></script>
<script src="tools/sha256.js"></script>
<script src="tools/filehandling.js"></script>
<script src="modules-election/blinded-voter/module.js"></script>
<script src="modules-election/blinded-voter/module-backend.js"></script>
<script src="modules-tally/publish-only/module.js"></script>
<script src="page.js"></script>
<script src="newelection.js"></script>
<script src="vote.js"></script>
<script src="getresult.js"></script>


<!-- Crypto-tool -->
<script type="text/javascript" src="tools/jsrsasign-master/ext/jsbn.js"></script>
<script type="text/javascript" src="tools/jsrsasign-master/ext/jsbn2.js"></script>
<script type="text/javascript" src="tools/jsrsasign-master/ext/prng4.js"></script>
<script type="text/javascript" src="tools/jsrsasign-master/ext/rng.js"></script>
<script type="text/javascript" src="tools/jsrsasign-master/ext/rsa.js"></script>
<script type="text/javascript" src="tools/jsrsasign-master/ext/rsa2.js"></script>
<script type="text/javascript" src="tools/jsrsasign-master/ext/base64.js"></script>

<!-- geprüft, sind notwendig ######## es wird eval() verwendet #########
#base64: wegen rstring2hex() -->
<script type="text/javascript" src="tools/jsrsasign-master/base64x-1.1.js"></script>
<script type="text/javascript" src="tools/jsrsasign-master/crypto-1.1.js"></script>
<script type="text/javascript" src="tools/jsrsasign-master/core.js"></script>
<script type="text/javascript" src="tools/jsrsasign-master/sha256.js"></script>

<script type="text/javascript" src="tools/jsrsasign-master/rsasign-1.2.js"></script>
<!-- Crypto-tool Ende -->

<script type="text/javascript">
	// var maincontent = '<object type="text/html" width="800" height="700" data="modules-auth/user-passw-list/module.html"></object>'; 
	// var maincontent = '<object type="text/html" width="800" height="700" data="getelectionconfig.html"></object>';
	
	var element = document.getElementById('newElectionHtml'); // heredoc replacement
	newElectionHtml = element.innerHTML;

	
	function userlog(log) {
	  var element = document.getElementById('logtextarea'); 
	  element.value = element.value + log;
	}

	// var maincontent = ''; //GetElectionConfig.getMainContent();
	// maincontent = startVoting();
	
	var newElectionPage = new NewElectionPage();
	var votePage        = new VotePage();
	var getResultPage   = new GetResultPage();
	
	var page = votePage;
	

</script>

</head>

<body onload="page.display(); //startVoting(true); //test();">
	<iframe id="diagnosisIFrame" style="display:none" width="50%" height="50%"></iframe>
	<div id="all">
		<div id="ci">
			<img id="logoimg" alt="Logo" src="logo125x149.svg" align="left">
			<h1>VVVote</h1>
			Online Wahl: Anonyme und nachvollziehbare Abstimmungen
		</div>

		<div id="nav">
			 <a onclick="page = newElectionPage; page.display(); // handleNewElection();"  >Neue Abstimmung anlegen</a> &nbsp;&nbsp;&nbsp;
			 <a onclick="page = votePage;        page.display(); // startVoting(true);"    >An Abstimmung teilnehmen</a> &nbsp;&nbsp;&nbsp; 
			 <a onclick="page = getResultPage;   page.display(); // startLoadingResult();" >Abstimmunsergebnis abrufen</a>
		</div>

		<div id="steps">
			<h1>Vorgehensweise</h1>
			<ul id="stepslist">
				<li><span id="step1" class="curr">Schritt 1: Wahlunterlagen holen</span></li>
				<li><span id="step2">Schritt 2: Autorisierung</span></li>
				<li><span id="step3"><a onclick="startStep3();">Schritt 3: Stimme abgeben</a></span></li>
				<li><span id="step4"><a onclick="startStep4();">Schritt 4: Abstimmungsergebnis holen</a></span></li>
			</ul>

		</div>
		<div id="maincontent">
			<h1 id="pagetitle">An Abstimmung teilnehmen</h1>
			<h2 id="steptitle">Schritt 1: Wahlunterlagen holen</h2>
			<!-- this div is replaced by the html of the according auth-module -->
			<div id="loadedmaincontent">
			<script type="text/javascript">
				document.write('');
			</script>
			</div>
		</div>
		<div id="log">
			<h1>Log:</h1>
			<textarea id="logtextarea" name="log"></textarea>

		</div>
	</div>
</body>
</html>
